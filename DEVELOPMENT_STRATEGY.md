# BedTimer 개발 전략

## 📋 개발 방법론

### Agile Scrum (2주 스프린트)
- **스프린트 길이**: 2주
- **데일리 스탠드업**: 매일 오전 9시 (15분)
- **스프린트 계획**: 스프린트 시작 시
- **스프린트 리뷰**: 스프린트 종료 시
- **회고**: 매 스프린트 후

### 개발 원칙
1. **영어 우선**: UI와 코드는 영어로 작성
2. **프라이버시 기본**: 사용자가 삭제를 제어할 수 있도록
3. **UX 일관성**: iPhone/Watch/Widgets 간 일관된 사용자 경험
4. **점진적 개발**: MVP부터 시작하여 점진적으로 기능 확장

## 🏗️ 아키텍처 설계

### MVVM + Repository 패턴

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│      View       │◄──►│   ViewModel     │◄──►│   Repository    │
│   (SwiftUI)     │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │                       │
                                ▼                       ▼
                       ┌─────────────────┐    ┌─────────────────┐
                       │   Use Cases     │    │   Data Sources  │
                       │                 │    │ (SwiftData,     │
                       └─────────────────┘    │  CloudKit)      │
                                              └─────────────────┘
```

### 핵심 컴포넌트

#### 1. Repository Layer
- **AlarmRepository**: UNUserNotificationCenter 래퍼
- **SessionRepository**: SwiftData CRUD + 파생 메트릭
- **SyncService**: WatchConnectivity → CloudKit (v2)

#### 2. Use Cases
- **StartSessionUseCase**: 세션 시작 로직
- **EndSessionUseCase**: 세션 종료 로직
- **DeleteSessionUseCase**: 세션 삭제 로직
- **SyncSessionsUseCase**: 세션 동기화 로직

#### 3. Data Models
```swift
@Model
class BedSession {
    var id: UUID
    var scheduledAlarm: Date
    var goalMinutes: Int
    var acknowledgedAt: Date?
    var outOfBedAt: Date?
    
    // 파생 속성
    var actualMinutes: Int { /* 계산 로직 */ }
    var metGoal: Bool { /* 계산 로직 */ }
}
```

## 🚀 개발 단계

### Phase 1: MVP (4주)
**목표**: 기본 기능이 동작하는 앱

#### Week 1-2: 기본 구조
- [ ] Xcode 워크스페이스 설정
- [ ] BedTimerKit 패키지 구성
- [ ] 기본 데이터 모델 (BedSession)
- [ ] iOS 앱 기본 UI
- [ ] 알람 설정 및 알림

#### Week 3-4: 핵심 기능
- [ ] 세션 시작/종료 로직
- [ ] 카운트다운 타이머
- [ ] 기본 통계 표시
- [ ] 로컬 데이터 저장 (SwiftData)

### Phase 2: Apple Watch (3주)
**목표**: Apple Watch 앱 추가

#### Week 5-6: Watch 앱
- [ ] watchOS 타겟 추가
- [ ] Watch UI 구현
- [ ] WatchConnectivity 기본 설정
- [ ] 햅틱 피드백

#### Week 7: Watch 최적화
- [ ] 컴플리케이션
- [ ] Siri 단축어
- [ ] 성능 최적화

### Phase 3: 위젯 및 고급 기능 (4주)
**목표**: 위젯과 고급 기능 추가

#### Week 8-9: 위젯
- [ ] WidgetKit 구현
- [ ] 다양한 위젯 크기
- [ ] Live Activity
- [ ] 위젯 상호작용

#### Week 10-11: 고급 기능
- [ ] 기록 삭제 기능
- [ ] 고급 통계
- [ ] 설정 화면
- [ ] 접근성 개선

### Phase 4: 동기화 및 배포 (3주)
**목표**: 클라우드 동기화 및 앱스토어 배포

#### Week 12-13: CloudKit
- [ ] CloudKit 통합
- [ ] 동기화 로직
- [ ] 충돌 해결
- [ ] 오프라인 지원

#### Week 14: 배포 준비
- [ ] TestFlight 배포
- [ ] 버그 수정
- [ ] 성능 최적화
- [ ] 앱스토어 제출

## 🧪 테스트 전략

### 테스트 피라미드
```
        ┌─────────────┐
        │ E2E Tests   │ ← 적은 수, 중요한 플로우
        └─────────────┘
       ┌───────────────┐
       │ Integration   │ ← 중간 수, 컴포넌트 간 상호작용
       │ Tests         │
       └───────────────┘
    ┌─────────────────────┐
    │ Unit Tests          │ ← 많은 수, 핵심 로직
    │                     │
    └─────────────────────┘
```

### 테스트 유형별 전략

#### Unit Tests (80%)
- **대상**: Repository, Use Cases, 비즈니스 로직
- **도구**: XCTest
- **목표**: 코드 커버리지 80% 이상

#### Integration Tests (15%)
- **대상**: 데이터베이스, 네트워크, 파일 시스템
- **도구**: XCTest + Mock 객체
- **목표**: 컴포넌트 간 상호작용 검증

#### UI Tests (5%)
- **대상**: 핵심 사용자 플로우
- **도구**: XCUITest
- **목표**: 주요 시나리오 검증

### 테스트 작성 원칙
1. **TDD**: 핵심 로직에 대해 테스트 우선 개발
2. **AAA 패턴**: Arrange, Act, Assert
3. **Mock 사용**: 외부 의존성 격리
4. **독립성**: 테스트 간 의존성 없음

## 🔧 품질 관리

### 코드 품질
- **SwiftLint**: 자동 코드 스타일 검사
- **SwiftFormat**: 자동 코드 포맷팅
- **Code Review**: 모든 PR에 대한 필수 리뷰

### 성능 목표
- **iOS 앱**: 300ms 이내 첫 화면 표시
- **watchOS 앱**: 500ms 이내 메인 화면 표시
- **메모리 사용량**: 50MB 이하
- **배터리 영향**: 최소화

### 접근성
- **VoiceOver**: 모든 UI 요소에 라벨 제공
- **Dynamic Type**: AA 등급 지원
- **색상 대비**: WCAG 2.1 AA 기준 충족
- **햅틱 피드백**: 중요한 액션에 제공

## 📊 메트릭 및 모니터링

### 개발 메트릭
- **코드 커버리지**: 80% 이상
- **빌드 시간**: 5분 이내
- **테스트 실행 시간**: 2분 이내
- **코드 리뷰 시간**: 24시간 이내

### 사용자 메트릭
- **알람 전환율**: 알람 → "일어났어" 클릭 비율
- **세션 완료율**: 세션 시작 → 완료 비율
- **목표 달성률**: 목표 시간 달성 비율
- **앱 크래시율**: 0.1% 이하

## 🚨 위험 관리

### 기술적 위험
1. **알림 신뢰성**
   - **위험**: iOS 알림이 제대로 동작하지 않음
   - **완화**: 온보딩 가이드, 테스트 알람 기능

2. **백그라운드 실행 제한**
   - **위험**: iOS 백그라운드 실행 제한
   - **완화**: 연속 타이머 대신 날짜 기반 계산

3. **동기화 충돌**
   - **위험**: CloudKit 동기화 충돌
   - **완화**: 확인된 outOfBedAt 우선순위

### 비즈니스 위험
1. **사용자 채택**
   - **완화**: 간단한 온보딩, 명확한 가치 제안

2. **경쟁사 대응**
   - **완화**: 독특한 기능, 우수한 UX

## 🔄 지속적 개선

### 정기 검토
- **주간**: 개발 진행 상황 검토
- **월간**: 아키텍처 및 기술 부채 검토
- **분기별**: 전략 및 로드맵 검토

### 학습 및 성장
- **기술 세미나**: 팀 내 기술 공유
- **외부 컨퍼런스**: iOS 개발 트렌드 학습
- **코드 리뷰**: 서로의 코드에서 학습

---

이 개발 전략은 BedTimer 프로젝트의 성공적인 개발을 위한 로드맵입니다. 프로젝트 진행에 따라 전략을 조정하고 개선해나가겠습니다.